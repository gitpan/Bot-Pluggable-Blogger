<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Bot::Pluggable::Blogger - ...</title>
<link rel="stylesheet" href="../../../../Active.css" type="text/css" />
<link rev="made" href="mailto:" />
</head>

<body>
<table border="0" width="100%" cellspacing="0" cellpadding="3">
<tr><td class="block" valign="middle">
<big><strong><span class="block">&nbsp;Bot::Pluggable::Blogger - ...</span></strong></big>
</td></tr>
</table>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#limitations">LIMITATIONS</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
	<li><a href="#license">LICENSE</a></li>
	<li><a href="#author">AUTHOR</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Bot::Pluggable::Blogger - ...</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>my $blogger = new Bot::Pluggable::Blogger(
   url=&gt;'http://bender.prather.org/',
   proxy=&gt;'http://www.prather.org/cgi-bin/mt/mt-xmlrpc.cgi',
   user=&gt;'IRC_BLOGGER',
   pass=&gt;'password',
   blog_id=&gt;'2',
   DEBUG=&gt;1,
);</p>
<p>my $bot = Bot::Pluggable-&gt;new(
    Modules =&gt; [],
    Objects =&gt; [$blogger],
    Nick =&gt; 'Blogger',
    Server =&gt; 'london.rhizomatic.net',
    Port =&gt; 6667,
);</p>
<p>$poe_kernel-&gt;run();
exit(0);</p>
<p>
</p>
<hr />
<h1><a name="description_a_wrapper_around_net::blogger_to_allow_posting_from_irc_to_a_blogger_api_(for_example_to_a_moveable_type_based_blog).">DESCRIPTION
         A Wrapper around Net::Blogger to allow posting from IRC to a Blogger
			 API (for example to a Moveable Type based Blog).</a></h1>
<pre>

=cut</pre>
<p>use POE;
use HTML::Entities;
use Net::Blogger;</p>
<p>sub getBlogger {
    my ($self) = @_;
    my $mt = Net::Blogger-&gt;new(engine=&gt;``movabletype'');
    $mt-&gt;Proxy(``$self-&gt;{proxy}'');
    $mt-&gt;Username(``$self-&gt;{user}'');
    $mt-&gt;Password(``$self-&gt;{pass}'');
    $mt-&gt;BlogId($self-&gt;{blog_id});
    return $mt;		
}</p>
<p>sub post {
    my ($self, $message, $nick) = @_;
    print STDERR ``posting $message to $self-&gt;{url} because of $nick\n'' if $self-&gt;{DEBUG}; 
    my $mt = $self-&gt;getBlogger;
		 my $title = (join ' ', (split /\s+/, $message)[0..2]).'...';
    $message = encode_entities($message, '&lt;&gt;&amp;');
    my $postID = $mt-&gt;metaWeblog()-&gt;newPost(title=&gt;encode_entities($title), description=&gt;``$nick says:\n\n $message'', publish=&gt;1);      
    return ``POSTED: $postID'';
}</p>
<p>sub update_post {
		my ($self, $postID, $message, $nick) = @_;
    my $mt = $self-&gt;getBlogger();
		my $post = $mt-&gt;metaWeblog()-&gt;getPost(postid=&gt;$postID) or warn $mt-&gt;LastError();
		return ``Post not found'' unless $post;
   ($message, $nick) = encode_entities($message, '&lt;&gt;&amp;``'), encode_entities($nick));
		my $ok = $mt-&gt;editPost(postid=&gt;$postID, postbody=&gt;\''$post-&gt;{description}\n$nick:\n\n $message``, publish=&gt;1);
		return ''UPDATED: $postID`` if $ok;
		return $mt-&gt;LastError();
}</p>
<p>sub title_post {
    my ($self, $postID, $title) = @_;
    my $mt = $self-&gt;getBlogger();
    my $post = $mt-&gt;metaWeblog()-&gt;getPost(postid=&gt;$postID) or warn $mt-&gt;LastError();
    return ``Post not found'' unless $post;
    my $ok = $mt-&gt;metaWeblog()-&gt;editPost(postid=&gt;$postID, title=&gt;encode_entities($title), description=&gt;$post-&gt;{description}, publish=&gt;1);
    return ``TITLED: $postID'' if $ok;
    return $mt-&gt;LastError();
}</p>
<p>sub told {
    my ($self, $nick, $channel, $message) = @_;
    my $sender = $channel || $nick;
    for ($message) {
        /^post[\:\,\;\.]?\s+(.+)$/i &amp;&amp; do { $self-&gt;tell($sender, $self-&gt;post($1, $nick)) };
        /^update\s+(\d+)[\:\,\;\.]?\s+(.+)$/i &amp;&amp; do { $self-&gt;tell($sender, $self-&gt;update_post($1, $2, $nick)) };
        /^title\s+(\d+)[\:\,\;\.]?\s+(.+)$/i &amp;&amp; do { $self-&gt;tell($sender, $self-&gt;title_post($1, $2)) };
        /^url\??$/ &amp;&amp; do { $self-&gt;tell($sender, ``Try: $self-&gt;{url}'') };
    }
}</p>
<p>#
# EVENTS
#</p>
<p>sub irc_public {
    my ($self, $bot, $nickstring, $channels, $message) = @_[OBJECT, SENDER, ARG0, ARG1, ARG2];  
    my $nick = $self-&gt;nick($nickstring);
    my $me = $bot-&gt;{Nick};
    $self-&gt;told($nick, $channels-&gt;[0], $1) if ($message =~ m/^\s*$me[\:\,\;\.]?\s*(.*)$/i);
		 return 0;
}</p>
<p>sub irc_msg {
    my ($self, $bot, $nickstring, $recipients, $message) = @_[OBJECT, SENDER, ARG0, ARG1, ARG2];
    my $nick = $self-&gt;nick($nickstring);
    $self-&gt;told($nick, undef, $message);
		return 0;
}</p>
<p>
</p>
<hr />
<h1><a name="limitations">LIMITATIONS</a></h1>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<pre>
    Copyright 2003, Chris Prather, All Rights Reserved</pre>
<p>
</p>
<hr />
<h1><a name="license">LICENSE</a></h1>
<p>You may use this module under the terms of the BSD, Artistic, oir GPL licenses,
any version.</p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Chris Prather &lt;<a href="mailto:chris@prather.org">chris@prather.org</a>&gt;</p>
<table border="0" width="100%" cellspacing="0" cellpadding="3">
<tr><td class="block" valign="middle">
<big><strong><span class="block">&nbsp;Bot::Pluggable::Blogger - ...</span></strong></big>
</td></tr>
</table>

</body>

</html>
